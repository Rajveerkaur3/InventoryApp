<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Inventory Manager</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { padding: 20px; background: #f8f9fa; }
        .table-responsive { max-height: 500px; overflow-y: auto; }
        #loading {
            display: none;
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
        }
        .low-stock { color: #dc3545; font-weight: bold; }
    </style>
</head>
<body>
    <div class="container">
        <h1 class="my-4">Inventory Manager</h1>
        
        <!-- Status Alert -->
        <div class="alert alert-info mb-3">
            API: <span id="apiStatus">Checking connection...</span>
            <span class="float-end" id="lastUpdated"></span>
        </div>

        <!-- Loading Overlay -->
        <div id="loading" class="d-flex justify-content-center align-items-center">
            <div class="spinner-border text-light" style="width: 3rem; height: 3rem;"></div>
        </div>

        <!-- Inventory Table -->
        <div class="card mb-4">
            <div class="card-header d-flex justify-content-between">
                <h2 class="mb-0">Current Inventory</h2>
                <button class="btn btn-sm btn-primary" onclick="loadInventory()">
                    Refresh
                </button>
            </div>
            <div class="card-body p-0">
                <div class="table-responsive">
                    <table class="table table-striped">
                        <thead>
                            <tr>
                                <th>Name</th>
                                <th>Description</th>
                                <th>Qty</th>
                                <th>Price</th>
                                <th>Location</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="inventoryList"></tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Add Item Form -->
        <div class="card">
            <div class="card-header">
                <h2 class="mb-0">Add New Item</h2>
            </div>
            <div class="card-body">
                <form id="addItemForm">
                    <div class="row g-2">
                        <div class="col-md-3">
                            <input type="text" class="form-control" name="item_name" placeholder="Name" required>
                        </div>
                        <div class="col-md-3">
                            <input type="text" class="form-control" name="item_description" placeholder="Description">
                        </div>
                        <div class="col-md-2">
                            <input type="number" class="form-control" name="item_qty_on_hand" placeholder="Qty" min="0" required>
                        </div>
                        <div class="col-md-2">
                            <input type="number" step="0.01" class="form-control" name="item_price" placeholder="Price" min="0" required>
                        </div>
                        <div class="col-md-2">
                            <input type="number" class="form-control" name="item_location_id" placeholder="Location ID" required>
                        </div>
                        <div class="col-md-2">
                            <button type="submit" class="btn btn-success w-100">Add</button>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script>
        // ===== CONFIGURATION =====
        const API_BASE_URL = 'https://r1o68l7ki6.execute-api.us-east-1.amazonaws.com';
        
        // ===== INITIAL LOAD =====
        document.addEventListener('DOMContentLoaded', () => {
            checkApiStatus();
            loadInventory();
        });

        // ===== API STATUS CHECK =====
        async function checkApiStatus() {
            try {
                const response = await fetch(`${API_BASE_URL}/item`);
                if (response.ok) {
                    document.getElementById('apiStatus').textContent = 'Connected';
                    document.getElementById('apiStatus').className = 'text-success';
                }
            } catch (error) {
                document.getElementById('apiStatus').textContent = 'Disconnected';
                document.getElementById('apiStatus').className = 'text-danger';
            }
        }

        // ===== LOAD INVENTORY =====
        async function loadInventory() {
            showLoading(true);
            try {
                const response = await fetch(`${API_BASE_URL}/item`);
                if (!response.ok) throw new Error('API request failed');
                
                const items = await response.json();
                renderInventory(items);
                updateTimestamp();
            } catch (error) {
                alert('Error loading inventory: ' + error.message);
            } finally {
                showLoading(false);
            }
        }

        // ===== RENDER INVENTORY =====
        function renderInventory(items) {
            const tableBody = document.getElementById('inventoryList');
            tableBody.innerHTML = items.map(item => `
                <tr>
                    <td>${item.item_name || 'N/A'}</td>
                    <td>${item.item_description || '-'}</td>
                    <td class="${item.item_qty_on_hand <= 5 ? 'low-stock' : ''}">
                        ${item.item_qty_on_hand || 0}
                    </td>
                    <td>$${(item.item_price || 0).toFixed(2)}</td>
                    <td>${item.item_location_id || 'N/A'}</td>
                    <td>
                        <button class="btn btn-sm btn-danger" 
                                onclick="deleteItem('${item.item_id}')">
                            Delete
                        </button>
                    </td>
                </tr>
            `).join('');
        }

        // ===== ADD ITEM =====
        document.getElementById('addItemForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            showLoading(true);
            
            const formData = new FormData(e.target);
            const data = {
                item_name: formData.get('item_name'),
                item_description: formData.get('item_description'),
                item_qty_on_hand: parseInt(formData.get('item_qty_on_hand')),
                item_price: parseFloat(formData.get('item_price')),
                item_location_id: parseInt(formData.get('item_location_id'))
            };

            try {
                const response = await fetch(`${API_BASE_URL}/item`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });
                
                if (!response.ok) throw new Error(await response.text());
                
                e.target.reset();
                loadInventory();
            } catch (error) {
                alert('Error adding item: ' + error.message);
            } finally {
                showLoading(false);
            }
        });

        // ===== DELETE ITEM =====
        async function deleteItem(itemId) {
            if (!confirm('Are you sure you want to delete this item?')) return;
            showLoading(true);
            
            try {
                const response = await fetch(`${API_BASE_URL}/item/${itemId}`, {
                    method: 'DELETE'
                });
                
                if (!response.ok) throw new Error(await response.text());
                loadInventory();
            } catch (error) {
                alert('Error deleting item: ' + error.message);
            } finally {
                showLoading(false);
            }
        }

        // ===== HELPER FUNCTIONS =====
        function showLoading(show) {
            document.getElementById('loading').style.display = show ? 'flex' : 'none';
        }
        
        function updateTimestamp() {
            document.getElementById('lastUpdated').textContent = 
                'Last updated: ' + new Date().toLocaleTimeString();
        }
    </script>
</body>
</html>
